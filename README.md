# Модель прогнозирования диабета — MLOps-проект (FastAPI + Docker + K8s)


Этот проект помогает изучить создание и развертывание ML-модели на простом и приближенном к реальности примере: прогнозирование наличия диабета у человека на основе медицинских показателей. Мы пройдем весь путь:
```
✅ Обучение модели
✅ Сборка модели локально
✅ Развертывание API с помощью FastAPI
✅ Контейнеризация с Docker
✅ Развертывание в Kubernetes
```
Этапы проекта:
```
┌─────────────────────────────────────────────────────────────┐
│                     ЛОКАЛЬНАЯ РАЗРАБОТКА                    │
└──────────────────────────────┬──────────────────────────────┘
                                ▼
┌─────────────────────────────────────────────────────────────┐
│  ШАГ 1: ПОДГОТОВКА ОКРУЖЕНИЯ                                │
│  • git clone https://github.com/...                         │
│  • python -m venv .mlops                                    │
│  • source .mlops/bin/activate                               │
│  • pip install -r requirements.txt                          │
└──────────────────────────────┬──────────────────────────────┘
                                ▼
┌─────────────────────────────────────────────────────────────┐
│  ШАГ 2: ОБУЧЕНИЕ МОДЕЛИ                                     │
│  • python train.py                                          │
│                                                             │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐   │
│  │  Загрузка    │    │  Разделение  │    │  Обучение    │   │
│  │   данных     │───▶│   данных     │───▶│   модели    │   │
│  │  (CSV URL)   │    │ (train/test) │    │ (RandomForest)│  │
│  └──────────────┘    └──────────────┘    └───────┬──────┘   │
│                                                  │          │
│  ┌──────────────┐                                │          │
│  │  Сохранение  │◀──────────────────────────────┘          │
│  │   модели     │                                           │
│  │ (diabetes_   │                                           │
│  │  model.pkl)  │                                           │
│  └──────────────┘                                           │
└──────────────────────────────┬──────────────────────────────┘
                                ▼
┌─────────────────────────────────────────────────────────────┐
│  ШАГ 3: ТЕСТИРОВАНИЕ API ЛОКАЛЬНО                           │
│  • uvicorn main:app --reload                                │
│  • Открыть http://localhost:8000/docs                       │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐    │
│  │                    FastAPI Swagger UI               │    │
│  │                                                     │    │
│  │  POST /predict                                      │    │
│  │  {                                                  │    │
│  │    "Pregnancies": 2,                                │    │
│  │    "Glucose": 130,                                  │    │
│  │    "BloodPressure": 70,                             │    │
│  │    "BMI": 28.5,                                     │    │
│  │    "Age": 45                                        │    │
│  │  }                                                  │    │
│  │                                                     │    │
│  │  → Ответ: {"diabetic": true}                        │    │
│  └─────────────────────────────────────────────────────┘    │
└──────────────────────────────┬──────────────────────────────┘
                                ▼
┌─────────────────────────────────────────────────────────────┐
│  ШАГ 4: DOCKER-ИЗОЛЯЦИЯ                                     │
│  • docker build -t diabetes-api .                           │
│  • docker run -p 8000:8000 diabetes-api                     │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐    │
│  │                DOCKER КОНТЕЙНЕР                     │    │
│  │  +-----------------------------------------------+  │    │
│  │  │ Python 3.10 + зависимости                     │  │    │
│  │  │ FastAPI сервер                                │  │    │
│  │  │ diabetes_model.pkl                            │  │    │
│  │  │ Порт 8000                                     │  │    │
│  │  +-----------------------------------------------+  │    │
│  └─────────────────────────────────────────────────────┘    │
└──────────────────────────────┬──────────────────────────────┘
                                ▼
┌─────────────────────────────────────────────────────────────┐
│  ШАГ 5: РУЧНОЙ ДЕПЛОЙ В KUBERNETES                          │
│  • kubectl apply -f k8s-deploy.yml                          │
│  • kubectl port-forward svc/... 1111:80                     │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐    │
│  │               KUBERNETES КЛАСТЕР                    │    │
│  │  +--------------------+    +--------------------+   │    │
│  │  │      Pod 1         │    │      Pod 2         │   │    │
│  │  │  ┌──────────────┐ │    │  ┌──────────────┐   │   │    │
│  │  │  │ Контейнер с  │ │    │  │ Контейнер с  │   │   │    │
│  │  │  │   API и      │ │    │  │   API и      │   │   │    │
│  │  │  │   моделью    │ │    │  │   моделью    │   │   │    │
│  │  │  └──────────────┘ │    │  └──────────────┘   │   │    │
│  │  +--------------------+    +--------------------+   │    │
│  │           │                         │               │    │
│  │           └───────────┬─────────────┘               │    │
│  │                       ▼                             │    │
│  │              +------------------+                   │    │
│  │              │   Service        │                   │    │
│  │              │  LoadBalancer    │                   │    │
│  │              │   порт 80 → 8000 │                   │    │
│  │              +------------------+                   │    │
│  └─────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```
## Задача

Предсказать, есть ли у человека диабет, на основе следующих параметров:
- Количество беременностей (Pregnancies)
- Уровень глюкозы (Glucose)
- Артериальное давление (Blood Pressure)
- Индекс массы тела — BMI
- Возраст (Age)

Используется классификатор Random Forest, обученный на датасете Pima Indians Diabetes Dataset.

## Быстрый старт
1. Клонировать репозиторий
```bash
git clone https://github.com/iam-veeramalla/first-mlops-project.git
cd first-mlops-project
```

2. Создать виртуальное окружение
```bash
python3 -m venv .mlops
source .mlops/bin/activate
```

4. Установить зависимости
```bash
pip install -r requirements.txt
```

## Обучение модели
```bash
python train.py
```

**Запуск API локально**
```bash
uvicorn main:app --reload
```

Пример входных данных для /predict
```jsonnet
{
  "Pregnancies": 2,
  "Glucose": 130,
  "BloodPressure": 70,
  "BMI": 28.5,
  "Age": 45
}
```
## **Контейнеризация API с Docker**
Сборка Docker-образа
```bash
docker build -t diabetes-prediction-model .
```

## **Запуск контейнера**
```bash
docker run -p 8000:8000 diabetes-prediction-model
```

## **Развертывание в Kubernetes**
```bash
kubectl apply -f k8s-deploy.yml
```
